# railway-client-typescript
High speed railway client (TypeScript version)


## Usage
1. 安装依赖包 `npm install`

2. 查询余票信息：`node dist/index.js leftTickets 2018-03-01 上海 徐州` 车次信息将用在第三步中，

3. 更改 **./dist/index.js** 文件中的账号和乘车信息并添加车次，乘车人信息需要事先在账号中维护。

4. 订票: `node dist/index.js`，首次登录需要输入验证码，验证码文件 `./captcha.BMP`，打开验证码文件，找到答案对应的位置依次输入到命令行窗口，用 "," 或者 " " 隔开，例如：1,6,7

```
| 1 | 2 | 3 | 4 |
| 5 | 6 | 7 | 8 |
```

5. 取消排队订单：`node dist/index.js cancelOrderQueue`

### 查询余票

* `node dist/index.js leftTickets 2018-03-01 上海 徐州` 查询2018年3月1日上海到徐州的车票
* `node dist/index.js leftTickets 2018-03-01 上海 徐州 --filter G,T` 查询2018年3月1日上海到徐州的 **高铁** 和 **特快** 车票
* `node dist/index.js leftTickets 2018-03-01 上海 苏州 徐州` 查询2018年3月1日上海到苏州并且是经停 **徐州** 的车票
* `node dist/index.js leftTickets 2018-03-01 上海 苏州 徐州 --filter G` 查询2018年3月1日上海到苏州并且是经停徐州的 **高铁** 车票

输出报表数据如下：

```
3    |4       |5       |6       |7    |8   |9   |10   |11 |20|21      |22|23  |24  |25    |26  |27|28  |29  |30    |31    |32
车次 |起始    |终点    |出发站 |到达站 |出发时|到达时|历时|  |  |高级软卧 |  |软卧|软座|特等座 |无座|  |硬卧 |硬座|二等座|一等座 |商务座
G1970|上海虹桥|兰州西  |上海虹桥|苏州北|06:09|06:32|00:23|Y |  |        |  |    |    |      |    |  |    |    |有    |4     |7
G1802|上海虹桥|郑州东  |上海虹桥|苏州北|06:14|06:37|00:23|Y |  |        |  |    |    |      |    |  |    |    |有    |1     |1
G102 |上海虹桥|北京南  |上海虹桥|苏州北|06:30|06:53|00:23|Y |  |        |  |    |    |      |    |  |    |    |有    |11    |1
G108 |上海虹桥|北京南  |上海虹桥|苏州北|07:19|07:42|00:23|Y |  |        |  |    |    |      |    |  |    |    |有    |有    |1
G1974|上海虹桥|重庆西  |上海虹桥|苏州北|07:24|07:48|00:24|Y |  |        |  |    |    |      |    |  |    |    |有    |1     |无
G1232|上海虹桥|丹东    |上海虹桥|苏州北|07:39|08:12|00:33|Y |  |        |  |    |    |      |    |  |    |    |有    |无    |无
...
```

#### Query Left Tickets Options

* `filter` | `f` : 车次过滤条件，输入部分或完整信息以`,`隔开，如 `G108,T`, `G,T`, `G`
* `time` | `t` : 出发时间范围过滤条件，输入如 `15:00,18:30`, `17:20`
* `orderby` | `o` : 按某些字段排序条件，默认递减排序，字段前加`+`符号则为递增排序，如 `历时,+出发时`

### 查询排队订单

`node dist/index.js orderWaitTime` 查询排队订单情况

### 查询未完成订单

`node dist/index.js myOrderNoComplete` 查询未完成订单情况

```
订单号     |乘车日期  |付款截至时间        |金额 |状态  |乘车人|车次 |出发站|到达站  |座位 |座位等级|乘车人类型
EG03398601|2018-03-02|2018-02-24 13:50:45|34.5|待支付|张三  |G1821|苏州北|上海虹桥|09A号|二等座  |成人票
```

### 取消未完成订单

`node dist/index.js cancelNoCompleteOrder EG03398601`

## Develop

`npm install`

`npm start` or `node dist/index.js`

### Prerequisites:

gulp: `npm install gulp -g`

## Updates
### v0.4
1. 新增定时检查用户登录状态功能，防止用户会话超时退出
2. 新增跨站订票能力
3. 新增订票成功后电脑响铃提醒
4. 利用 [RxJS](https://github.com/Reactive-Extensions/RxJS) 优化项目代码结构

### v0.3

1. 新增跨站查询余票报表
2. 简化验证码输入方式
